<html><head><title>Audio Manifest Index</title>

<script language="JavaScript" type="text/javascript">
<!-- // Javascript to create a popup window to play the audio files / separate window for link 
function loadpage(url) {
  myWindow = window.open ('', 'Audio', 'toolbar=0,titlebar=0,location=0,directories=0,status=0,menubar=0,scrollbars=auto,resizable=yes,width=400,height=400');
  //window.blur();
  myWindow.document.write("<html><title>Sample Player</title><body><embed src='"+url+"' height=100 width=350 />");
  myWindow.document.write("<p>This file: "+url+"</p></body></html>");
  myWindow.document.close();
  if (window.focus) {myWindow.focus()}
}
// --> </script>

</head>
<body>

<% main_dir = "./" -%>

<h3>This Manifest Index Created: <pre><%= Time.now.inspect %></pre></h3>
<h3>From the sub-directories of: <pre><%= main_dir %></pre></h3>

<% d = Dir.new(main_dir).sort -%>

<!-- Contents Section -->
<h2>Contents:</h2><ul>
<% d.each do |dir|
    if (dir != "..") && File.directory?("#{main_dir}/#{dir}") -%>
      <li><a href='#<%= dir %>'><%= dir %></a></li>
    <% end
   end -%>
</ul>


<!-- For each Manifest list contents -->
<% d.each do |dir|
  if (dir != "..") && File.directory?("#{main_dir}/#{dir}")
    full_dir_path = "#{main_dir}#{dir}"
    d2 = Dir.new(full_dir_path)
    d2.each do |filename|
      # For each non hidden .csv file in the directory, output its contents as html 
      next if !filename.end_with?(".csv") || filename[0]=="."
      filename =  "#{full_dir_path}/#{filename}"
      f = File.new(filename, "r")
      this_dir = File.dirname(filename)
      dir_name = File.basename(this_dir) -%>

<h3><a name='#<%= dir_name %>'><%= dir_name %></a></h3>
<b>Location:</b> <a href='<%= this_dir %>'><%= this_dir %></a><br/>
<b>Manifest:</b> <a href='<%= filename %>'><%= File.basename(filename) %></a></br>
<b>Manifest Last Modified:</b> <%= f.mtime %>
<table border=1>
   <% f.each do |line|
        header = false
        column = 0
        line = line + ","
        # If the current line starts with "Recording, Description," then it is a header row 
        header = true if line.start_with?("Recording, Description,") -%>
  <tr>
     <% sample_info = line.scan(/(".*?"|[^,]*),/)
        sample_info.each do |x|
          if header -%><th><% else -%><td><% end -%>
          <% if column == 0 && !header && !sample_info[9].nil? -%>
<a href="javascript:loadpage('<%= "#{this_dir}/#{x[0]}.#{sample_info[9][0].strip.downcase}"-%>');"><%= x[0] -%></a>
          <% else -%>
<%= x[0] -%>
          <% end -%>       
       <% if header -%>
</th><% else -%>
</td><% end -%>
       <% column += 1
        end -%>
  </tr>
   <% end -%>
</table>
   <% end
  end
end -%>
</body></html>
